'use client';

import React, { useState, useRef, useEffect } from 'react';
import Checkbox from '../../ui buttons/Checkbox';

export interface FieldDefinition {
  isSearchable: boolean;
  id?: string;
  fieldKey: string;
  displayName: string;
  fieldType?: string;
  isVisible?: boolean;
}

export interface SearchBoardProps {
  fieldDefinitions: FieldDefinition[];
  searchQuery?: string;
  onSearchChange?: (query: string) => void;
  selectedColumns?: string[];
  onColumnsChange?: (columnKeys: string[]) => void;
  placeholder?: string;
  className?: string;
}

const SearchBoard: React.FC<SearchBoardProps> = ({
  fieldDefinitions = [],
  searchQuery = '',
  onSearchChange,
  selectedColumns: controlledSelectedColumns,
  onColumnsChange,
  placeholder = 'Search this board',
  className = '',
}) => {
  const searchableFields = fieldDefinitions.filter(f => f.isSearchable !== false);
  const [internalSearchQuery, setInternalSearchQuery] = useState(searchQuery);
  const [internalSelectedColumns, setInternalSelectedColumns] = useState<string[]>(
     controlledSelectedColumns || searchableFields.map(f => f.fieldKey)
   );
  const [columnSearchQuery, setColumnSearchQuery] = useState('');
  const [isDropdownOpen, setIsDropdownOpen] = useState(false);
  const [isFocused, setIsFocused] = useState(false);
  const filterButtonRef = useRef<HTMLButtonElement>(null);
  const dropdownRef = useRef<HTMLDivElement>(null);
  const autoInitControlledRef = useRef(false);

  const selectedColumns = controlledSelectedColumns || internalSelectedColumns;
  const setSelectedColumns = (cols: string[]) => {
    setInternalSelectedColumns(cols);
    onColumnsChange?.(cols);
  };

  const handleSearchChange = (query: string) => {
    setInternalSearchQuery(query);
    onSearchChange?.(query);
  };

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (
        dropdownRef.current &&
        !dropdownRef.current.contains(event.target as Node) &&
        filterButtonRef.current &&
        !filterButtonRef.current.contains(event.target as Node)
      ) {
        setIsDropdownOpen(false);
      }
    };

    if (isDropdownOpen) {
      document.addEventListener('mousedown', handleClickOutside);
    }
    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [isDropdownOpen]);

  // Initialize selected columns to all searchable fields once fields load (when uncontrolled)
  useEffect(() => {
    if (!controlledSelectedColumns && internalSelectedColumns.length === 0 && searchableFields.length > 0) {
      setInternalSelectedColumns(searchableFields.map(f => f.fieldKey));
    }
  }, [controlledSelectedColumns, searchableFields.length]);

  // If controlled but empty on first open, initialize parent with all searchable fields
  useEffect(() => {
    if (
      Array.isArray(controlledSelectedColumns) &&
      controlledSelectedColumns.length === 0 &&
      searchableFields.length > 0 &&
      !autoInitControlledRef.current
    ) {
      onColumnsChange?.(searchableFields.map(f => f.fieldKey));
      autoInitControlledRef.current = true;
    }
  }, [controlledSelectedColumns, searchableFields.length, onColumnsChange]);

  const filteredColumns = searchableFields.filter((field) =>
     field.displayName.toLowerCase().includes(columnSearchQuery.toLowerCase())
   );

  const handleToggleAll = () => {
     if (selectedColumns.length === searchableFields.length) {
       setSelectedColumns([]);
     } else {
       setSelectedColumns(searchableFields.map(f => f.fieldKey));
     }
   };

  const handleToggleColumn = (fieldKey: string) => {
    if (selectedColumns.includes(fieldKey)) {
      setSelectedColumns(selectedColumns.filter(k => k !== fieldKey));
    } else {
      setSelectedColumns([...selectedColumns, fieldKey]);
    }
  };

  const getFieldIcon = (fieldKey: string) => {
    const iconPath = `/${fieldKey}.svg`;
    return (
      <img
        src={iconPath}
        alt=""
        className="shrink-0"
        style={{ width: '14px', height: '14px', maxWidth: 'none', maxHeight: 'none' }}
        onError={(e) => {
          (e.currentTarget as HTMLImageElement).style.display = 'none';
        }}
      />
    );
  };

  const [dropdownPosition, setDropdownPosition] = useState({ top: 0, left: 0 });

  useEffect(() => {
    if (isDropdownOpen && filterButtonRef.current) {
      const rect = filterButtonRef.current.getBoundingClientRect();
      setDropdownPosition({
        top: rect.bottom + 4,
        left: rect.left,
      });
    }
  }, [isDropdownOpen]);

  return (
    <div className={`relative ${className}`}>
      <div className="flex items-center gap-0">
        <div className="relative flex-1">
          <div
            className={`flex items-center gap-2 px-4 py-1.5 bg-white border rounded-[3px] h-[30px] ${
              isFocused ? 'border-red-600' : 'border-black/15'
            }`}
            style={{ width: '241px' }}
          >
            <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" className="shrink-0">
              <path d="M5.87634 0.000157806C5.91449 0.00023257 5.91449 0.00023257 5.9534 0.000308845C6.31989 0.00151929 6.67579 0.0122563 7.03503 0.090734C7.06953 0.0977725 7.06953 0.0977725 7.10472 0.104953C7.89503 0.267638 8.6456 0.579673 9.30456 1.04777C9.32253 1.06029 9.3405 1.07282 9.35902 1.08572C10.5733 1.93677 11.4327 3.25616 11.7166 4.71258C11.7773 5.07135 11.8041 5.42668 11.8031 5.7902C11.8031 5.822 11.8031 5.822 11.8031 5.85444C11.7986 7.24971 11.2729 8.63711 10.3163 9.66105C10.3528 9.74243 10.3926 9.79885 10.4564 9.861C10.4712 9.87556 10.4859 9.89011 10.5011 9.90511C10.5349 9.93641 10.569 9.96745 10.6042 9.99725C10.77 10.1383 10.9228 10.2918 11.0761 10.4461C11.1248 10.4952 11.1736 10.5442 11.2224 10.5931C11.3436 10.7147 11.4646 10.8363 11.5856 10.958C11.6882 11.0611 11.7908 11.1642 11.8935 11.2672C11.9413 11.3151 11.9889 11.3631 12.0366 11.4111C12.1694 11.5445 12.303 11.675 12.4463 11.7974C12.5831 11.9191 12.7108 12.051 12.8402 12.1804C12.8723 12.2124 12.9043 12.2443 12.9364 12.2763C13.0031 12.3429 13.0698 12.4095 13.1365 12.4762C13.2218 12.5615 13.3074 12.6467 13.393 12.7318C13.459 12.7976 13.525 12.8635 13.5909 12.9294C13.6224 12.9608 13.6539 12.9923 13.6855 13.0237C13.7295 13.0674 13.7734 13.1114 13.8172 13.1554C13.8422 13.1803 13.8672 13.2052 13.8929 13.2309C14.0099 13.361 14.02 13.4613 14.0161 13.6325C14.0029 13.7506 13.9728 13.8057 13.8983 13.8993C13.7626 14.0073 13.6551 14.0212 13.4839 14.0232C13.2771 13.9846 13.1413 13.8368 13.0003 13.692C12.9805 13.672 12.9607 13.652 12.9402 13.6313C12.8771 13.5676 12.8143 13.5036 12.7516 13.4396C12.6889 13.3759 12.6261 13.3123 12.5632 13.2488C12.5243 13.2094 12.4854 13.1699 12.4466 13.1303C12.3615 13.0439 12.2757 12.9604 12.1834 12.8816C12.0389 12.757 11.9057 12.6207 11.7713 12.4853C11.7226 12.4363 11.6738 12.3873 11.625 12.3383C11.5038 12.2168 11.3828 12.0951 11.2618 11.9735C11.1592 11.8703 11.0566 11.7673 10.9539 11.6643C10.9061 11.6164 10.8585 11.5684 10.8108 11.5204C10.6748 11.3837 10.5381 11.2496 10.3913 11.1244C10.3128 11.0561 10.2399 10.9826 10.1667 10.9087C10.1513 10.8932 10.1358 10.8777 10.1199 10.8617C10.0713 10.813 10.0229 10.7643 9.97448 10.7155C9.94124 10.6821 9.90798 10.6487 9.87472 10.6154C9.79397 10.5343 9.7133 10.4532 9.63269 10.372C9.52029 10.4147 9.43311 10.4672 9.33532 10.5378C8.66764 11.0085 7.93928 11.3127 7.1444 11.4931C7.11903 11.4989 7.09366 11.5048 7.06751 11.5109C6.34086 11.6718 5.49409 11.6772 4.7655 11.5204C4.74319 11.516 4.72087 11.5116 4.69789 11.5071C3.24005 11.2175 1.90312 10.3595 1.04675 9.14152C1.03583 9.12609 1.02491 9.11067 1.01366 9.09477C0.410985 8.2378 0.0118883 7.16928 0.00116958 6.11416C0.000901784 6.09215 0.000633983 6.07014 0.000358067 6.04746C-0.0153991 4.41511 0.488278 2.95793 1.63507 1.77291C1.66674 1.74075 1.6985 1.70867 1.73034 1.67667C1.74555 1.66135 1.76076 1.64603 1.77643 1.63025C2.15727 1.2513 2.59432 0.95481 3.0647 0.697904C3.10231 0.677307 3.13978 0.656449 3.17704 0.635206C3.69221 0.34146 4.31796 0.153272 4.90222 0.0633902C4.94475 0.0562955 4.94475 0.0562955 4.98815 0.0490575C5.28469 0.00379311 5.57691 -0.00105814 5.87634 0.000157806ZM2.14904 2.5756C2.11832 2.61276 2.08821 2.65044 2.05847 2.68839C2.04133 2.7098 2.04133 2.7098 2.02385 2.73164C1.5495 3.32721 1.21016 3.99673 1.04162 4.74088C1.03527 4.7689 1.03527 4.7689 1.02878 4.79748C0.958142 5.12673 0.926706 5.45188 0.927119 5.78849C0.927115 5.80733 0.927112 5.82617 0.927109 5.84558C0.927997 6.20464 0.968883 6.54873 1.04675 6.89933C1.05084 6.91869 1.05493 6.93806 1.05914 6.95801C1.23867 7.79187 1.70629 8.54656 2.28063 9.16544C2.29599 9.18202 2.31134 9.1986 2.32716 9.21568C2.50945 9.40869 2.70922 9.57345 2.92492 9.7277C2.95728 9.75084 2.95728 9.75084 2.99029 9.77445C4.10406 10.5646 5.4444 10.8364 6.78755 10.6251C7.51613 10.499 8.21676 10.2108 8.81237 9.77042C8.84138 9.74913 8.87039 9.72784 8.90028 9.70591C9.17894 9.49809 9.43771 9.27294 9.66003 9.0048C9.68107 8.98069 9.70212 8.95658 9.7238 8.93174C10.1824 8.39913 10.5065 7.76494 10.6991 7.09073C10.7062 7.06654 10.7133 7.04234 10.7206 7.01742C11.0274 5.94318 10.8937 4.72329 10.3983 3.72745C10.3889 3.7084 10.3796 3.68935 10.3699 3.66972C10.0758 3.07779 9.67298 2.54287 9.16784 2.11417C9.15003 2.09905 9.13222 2.08392 9.11387 2.06834C7.09304 0.379098 4.13683 0.612444 2.14904 2.5756Z" fill="#4F5051"/>
            </svg>

            <input
              type="text"
              value={internalSearchQuery}
              onChange={(e) => handleSearchChange(e.target.value)}
              onFocus={() => setIsFocused(true)}
              onBlur={() => setIsFocused(false)}
              placeholder={placeholder}
              className="flex-1 outline-none text-sm text-[#4F5051] placeholder:text-[#4F5051] bg-transparent"
            />

            <button
              ref={filterButtonRef}
              type="button"
              onClick={() => setIsDropdownOpen(!isDropdownOpen)}
              className="shrink-0 p-0 hover:opacity-80 transition-opacity"
            >
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clipPath="url(#clip0_662_48802)">
                  <path d="M15.0378 13.397C15.4291 13.7313 15.7088 14.1523 15.8581 14.647C15.8581 14.6857 15.8581 14.7243 15.8581 14.7642C15.9039 14.7637 15.9497 14.7633 15.9969 14.7629C16.4291 14.7589 16.8613 14.756 17.2935 14.7541C17.5157 14.753 17.7379 14.7517 17.96 14.7494C18.1746 14.7473 18.3891 14.7461 18.6036 14.7456C18.6853 14.7453 18.7671 14.7446 18.8488 14.7435C18.9635 14.7421 19.0782 14.7419 19.193 14.742C19.2265 14.7413 19.2601 14.7406 19.2947 14.7399C19.5351 14.7419 19.6951 14.807 19.8816 14.9595C19.9963 15.1009 20.0148 15.209 20.0134 15.3892C20.0137 15.4287 20.014 15.4681 20.0143 15.5088C19.9897 15.6901 19.9056 15.813 19.7644 15.9263C19.5736 16.0694 19.4089 16.0586 19.1797 16.0577C19.1259 16.0577 19.1259 16.0577 19.0711 16.0577C18.9525 16.0577 18.8339 16.0574 18.7154 16.0571C18.6332 16.057 18.551 16.0569 18.4689 16.0569C18.2525 16.0567 18.0362 16.0563 17.8198 16.0559C17.5991 16.0555 17.3784 16.0553 17.1577 16.0551C16.7245 16.0547 16.2913 16.0541 15.8581 16.0532C15.8529 16.089 15.8476 16.1247 15.8422 16.1615C15.7369 16.7362 15.3105 17.2112 14.8621 17.5547C14.3961 17.8737 13.8948 18.0295 13.3313 18.0259C13.2701 18.0256 13.2701 18.0256 13.2076 18.0252C12.508 18.0092 11.9298 17.7315 11.4233 17.2483C11.1195 16.9291 10.8813 16.5238 10.78 16.0923C10.7583 16.0923 10.7366 16.0922 10.7142 16.0922C9.42636 16.0899 8.13855 16.087 6.85074 16.0834C6.69613 16.0829 6.54153 16.0825 6.38692 16.082C6.35614 16.082 6.32537 16.0819 6.29365 16.0818C5.79518 16.0804 5.29671 16.0794 4.79824 16.0786C4.28682 16.0778 3.7754 16.0765 3.26398 16.0748C2.94837 16.0737 2.63276 16.073 2.31715 16.0728C2.07519 16.0726 1.83325 16.0717 1.5913 16.0706C1.492 16.0703 1.3927 16.0702 1.2934 16.0702C1.15799 16.0703 1.02261 16.0696 0.887212 16.0688C0.847769 16.069 0.808327 16.0692 0.767689 16.0694C0.497364 16.0666 0.330347 16.0224 0.123286 15.8384C-0.0272059 15.6664 -0.0167769 15.4923 -0.0146531 15.2727C0.00467014 15.103 0.0630016 14.9908 0.194087 14.8814C0.410224 14.7422 0.601289 14.7479 0.849632 14.7501C0.892103 14.75 0.934574 14.7499 0.978333 14.7498C1.12066 14.7496 1.26298 14.7502 1.40531 14.7509C1.50733 14.7509 1.60935 14.7509 1.71137 14.7508C1.93102 14.7508 2.15066 14.7511 2.37031 14.7518C2.68788 14.7527 3.00545 14.753 3.32302 14.7532C3.83829 14.7534 4.35355 14.7542 4.86881 14.7553C5.36928 14.7564 5.86976 14.7572 6.37023 14.7577C6.40109 14.7578 6.43195 14.7578 6.46375 14.7578C6.61856 14.758 6.77337 14.7581 6.92818 14.7583C8.21213 14.7595 9.49608 14.7616 10.78 14.7642C10.788 14.7372 10.7959 14.7103 10.8041 14.6826C10.8146 14.6473 10.8251 14.6121 10.8359 14.5757C10.8463 14.5407 10.8567 14.5058 10.8674 14.4697C11.056 13.8619 11.5355 13.3683 12.0862 13.0698C13.0492 12.5692 14.2072 12.7054 15.0378 13.397ZM12.2913 14.542C12.0453 14.8495 11.9609 15.1981 11.991 15.5845C12.0647 15.9937 12.2692 16.3016 12.6047 16.544C12.8945 16.726 13.2132 16.7875 13.551 16.7319C13.9444 16.6386 14.215 16.4597 14.4519 16.1314C14.6638 15.7824 14.7081 15.4095 14.6246 15.0068C14.4967 14.6405 14.2364 14.3714 13.8953 14.1953C13.3196 13.9266 12.7188 14.0802 12.2913 14.542Z" fill="#4F5051"/>
                  <path d="M13.3129 1.97675C13.3745 1.97724 13.3745 1.97724 13.4373 1.97774C14.1951 1.99415 14.7931 2.31509 15.3124 2.85322C15.5839 3.14782 15.801 3.55148 15.8593 3.94697C15.9048 3.94671 15.9503 3.94645 15.9971 3.94618C16.4259 3.9438 16.8547 3.94205 17.2834 3.9409C17.5039 3.94029 17.7243 3.93946 17.9447 3.93813C18.1575 3.93686 18.3702 3.93615 18.583 3.93585C18.6641 3.93563 18.7453 3.93521 18.8264 3.93458C18.9401 3.93373 19.0538 3.93361 19.1675 3.93367C19.2178 3.93303 19.2178 3.93303 19.269 3.93239C19.4907 3.93353 19.6611 3.96665 19.8298 4.12412C20.0162 4.36782 20.0279 4.54063 19.9999 4.84541C19.9099 5.04705 19.7726 5.15411 19.5703 5.23603C19.4459 5.25677 19.3244 5.25587 19.1986 5.25377C19.1623 5.25379 19.1261 5.25382 19.0888 5.25384C18.9697 5.25373 18.8508 5.25252 18.7318 5.25129C18.649 5.251 18.5662 5.25078 18.4834 5.25062C18.266 5.25003 18.0486 5.24849 17.8312 5.24676C17.6092 5.24516 17.3871 5.24445 17.1651 5.24366C16.7298 5.24199 16.2946 5.23932 15.8593 5.23603C15.8518 5.27181 15.8518 5.27181 15.8442 5.30831C15.834 5.35547 15.834 5.35547 15.8237 5.40358C15.8138 5.45024 15.8138 5.45024 15.8037 5.49783C15.706 5.88809 15.4359 6.20968 15.1562 6.48603C15.1294 6.51373 15.1025 6.54142 15.0749 6.56996C14.5856 7.04381 13.9002 7.24425 13.2301 7.23402C12.5082 7.19421 11.8662 6.88838 11.3671 6.36884C11.0774 6.02179 10.8878 5.67269 10.7812 5.23603C10.7485 5.23614 10.7485 5.23614 10.7152 5.23626C9.42377 5.24063 8.13237 5.24398 6.84096 5.24601C6.68587 5.24625 6.53078 5.2465 6.37569 5.24676C6.34481 5.24681 6.31394 5.24686 6.28213 5.24692C5.78232 5.24777 5.28251 5.24931 4.7827 5.2511C4.26978 5.25293 3.75686 5.25401 3.24394 5.25441C2.92748 5.25468 2.61104 5.25552 2.29459 5.25711C2.05186 5.25826 1.80913 5.25839 1.56639 5.25812C1.46687 5.25818 1.36735 5.25857 1.26783 5.25931C1.13194 5.26029 0.996091 5.26005 0.860191 5.25952C0.801141 5.26037 0.801141 5.26037 0.740897 5.26124C0.485545 5.25854 0.314273 5.20683 0.117126 5.04072C0.00242445 4.89927 -0.0160881 4.79118 -0.0147095 4.61103C-0.0150116 4.57155 -0.0153137 4.53208 -0.015625 4.4914C0.00897249 4.31006 0.0930658 4.18722 0.234314 4.07392C0.377383 3.96662 0.470466 3.94213 0.644163 3.94155C0.680318 3.94134 0.716474 3.94113 0.753726 3.9409C0.79351 3.94087 0.833295 3.94083 0.874284 3.94079C0.916496 3.9406 0.958707 3.9404 1.0022 3.9402C1.14435 3.9396 1.2865 3.93928 1.42865 3.93895C1.53027 3.93858 1.63188 3.93818 1.7335 3.93778C1.95264 3.93693 2.17177 3.93622 2.39091 3.93561C2.70775 3.93472 3.02459 3.93362 3.34143 3.93247C3.85545 3.93061 4.36948 3.92892 4.8835 3.92733C5.38289 3.9258 5.88227 3.92418 6.38165 3.92245C6.41242 3.92234 6.4432 3.92224 6.4749 3.92213C6.62928 3.92159 6.78365 3.92106 6.93802 3.92052C8.21908 3.91607 9.50013 3.9119 10.7812 3.90791C10.7966 3.86448 10.7966 3.86448 10.8123 3.82018C10.826 3.78191 10.8397 3.74363 10.8538 3.7042C10.8673 3.66639 10.8808 3.62858 10.8947 3.58962C11.1479 2.9299 11.6543 2.47898 12.2753 2.16993C12.6153 2.02436 12.9449 1.97298 13.3129 1.97675ZM12.4365 3.58076C12.1358 3.85321 11.9975 4.20682 11.9775 4.60371C11.9863 4.96287 12.1366 5.28991 12.3828 5.54853C12.6556 5.79762 12.9593 5.92003 13.3276 5.94892C13.7376 5.92204 14.0639 5.75777 14.3456 5.46308C14.6017 5.15667 14.6771 4.87064 14.6629 4.47263C14.6195 4.06841 14.4461 3.78344 14.1406 3.51728C13.5959 3.14302 12.9517 3.18249 12.4365 3.58076Z" fill="#4F5051"/>
                  <path d="M8.27957 7.89839C8.37616 7.98311 8.46589 8.07094 8.55469 8.16374C8.58223 8.19053 8.60977 8.21731 8.63815 8.24491C8.94743 8.56303 9.11618 8.9485 9.21875 9.37468C9.24065 9.37462 9.26254 9.37456 9.28511 9.3745C10.5827 9.371 11.8803 9.36832 13.1779 9.3667C13.3337 9.3665 13.4895 9.3663 13.6452 9.36609C13.6762 9.36605 13.7073 9.36601 13.7392 9.36597C14.2415 9.36529 14.7437 9.36406 15.246 9.36262C15.7613 9.36116 16.2766 9.36029 16.7919 9.35997C17.1099 9.35976 17.4279 9.35908 17.7459 9.35781C17.9897 9.35689 18.2335 9.35679 18.4773 9.357C18.5773 9.35696 18.6774 9.35665 18.7775 9.35605C18.9139 9.35527 19.0503 9.35546 19.1867 9.35589C19.2463 9.3552 19.2463 9.3552 19.3072 9.35451C19.5326 9.35642 19.666 9.37806 19.8438 9.53093C19.9855 9.68012 20.0121 9.79978 20.0195 9.99968C20.0121 10.1996 19.9855 10.3192 19.8438 10.4684C19.6317 10.6508 19.4532 10.6465 19.1867 10.6435C19.1441 10.6436 19.1015 10.6437 19.0575 10.6439C18.9147 10.6441 18.7718 10.6433 18.6289 10.6424C18.5265 10.6424 18.4241 10.6424 18.3217 10.6425C18.1012 10.6426 17.8808 10.6421 17.6603 10.6412C17.3415 10.6399 17.0227 10.6395 16.704 10.6393C16.1868 10.639 15.6696 10.6379 15.1523 10.6365C14.65 10.635 14.1476 10.6339 13.6452 10.6333C13.6143 10.6332 13.5833 10.6332 13.5514 10.6331C13.396 10.6329 13.2406 10.6327 13.0852 10.6325C11.7964 10.6309 10.5076 10.6282 9.21875 10.6247C9.21097 10.6542 9.2032 10.6837 9.19519 10.7141C9.18484 10.7528 9.1745 10.7915 9.16384 10.8313C9.15364 10.8697 9.14345 10.9081 9.13295 10.9476C9.02067 11.3295 8.75208 11.6368 8.47656 11.9137C8.44197 11.9504 8.44197 11.9504 8.40668 11.9877C7.92971 12.4532 7.24595 12.6381 6.59667 12.6333C5.86949 12.6092 5.21301 12.3042 4.71069 11.7758C4.45997 11.485 4.25819 11.1716 4.17678 10.7928C4.16995 10.7613 4.16312 10.7298 4.15608 10.6973C4.14843 10.6614 4.14843 10.6614 4.14062 10.6247C4.07094 10.6252 4.07094 10.6252 3.99984 10.6257C3.56188 10.6289 3.12392 10.6312 2.68595 10.6328C2.46079 10.6336 2.23564 10.6347 2.01048 10.6365C1.79317 10.6382 1.57586 10.6391 1.35854 10.6395C1.27566 10.6398 1.19277 10.6404 1.10989 10.6412C0.99374 10.6423 0.877626 10.6425 0.761471 10.6424C0.727248 10.643 0.693026 10.6435 0.657766 10.6441C0.444988 10.6427 0.325441 10.6093 0.15625 10.4684C0.0145181 10.3192 -0.0121096 10.1996 -0.0195312 9.99968C-0.0121096 9.79978 0.0145181 9.68012 0.15625 9.53093C0.358725 9.3623 0.50965 9.3528 0.761471 9.35694C0.816386 9.3569 0.816386 9.3569 0.872411 9.35687C0.992897 9.35698 1.11335 9.35819 1.23383 9.35942C1.31757 9.35971 1.40131 9.35993 1.48505 9.36009C1.70507 9.36068 1.92507 9.36222 2.14508 9.36395C2.36974 9.36555 2.5944 9.36626 2.81906 9.36705C3.25959 9.36872 3.70011 9.37139 4.14062 9.37468C4.14572 9.35071 4.15082 9.32674 4.15608 9.30205C4.16291 9.27052 4.16974 9.23899 4.17678 9.2065C4.18349 9.17529 4.1902 9.14407 4.19712 9.11191C4.33177 8.55925 4.77427 8.08258 5.23438 7.77311C6.1959 7.21267 7.37534 7.2235 8.27957 7.89839ZM5.66406 9.10124C5.3903 9.47193 5.31162 9.81559 5.35156 10.2731C5.43668 10.6406 5.65825 10.9498 5.97656 11.1496C6.31473 11.3329 6.64743 11.3819 7.02606 11.3051C7.38226 11.1946 7.66341 10.9612 7.85156 10.6393C8.03488 10.2643 8.06437 9.90288 7.93106 9.50666C7.78061 9.1609 7.48597 8.875 7.13867 8.73259C6.60153 8.5612 6.05841 8.69691 5.66406 9.10124Z" fill="#4F5051"/>
                </g>
                <defs>
                  <clipPath id="clip0_662_48802">
                    <rect width="20" height="20" fill="white"/>
                  </clipPath>
                </defs>
              </svg>
            </button>
          </div>
        </div>
      </div>

      {isDropdownOpen && (
        <div
          ref={dropdownRef}
          className="absolute z-50 bg-white border border-[rgba(0,0,0,0.15)] rounded-[3px] shadow-lg"
          style={{
            width: '241px',
            maxHeight: '386px',
            top: '34px',
            left: '0',
          }}
        >
          <div className="p-3">
            <div className="text-sm text-[#4F5051] mb-3">Choose columns to search</div>

            <div className="relative mb-3">
              <div className="flex items-center gap-2 px-3 py-1.5 bg-white border border-black/15 rounded-[3px] h-[26px]">
                <svg width="12" height="12" viewBox="0 0 11 11" fill="none" className="shrink-0">
                  <path d="M4.5 8C6.433 8 8 6.433 8 4.5S6.433 1 4.5 1 1 2.567 1 4.5 2.567 8 4.5 8z" stroke="#4F5051" strokeWidth="1.5"/>
                  <path d="M10 10l-2.5-2.5" stroke="#4F5051" strokeWidth="1.5" strokeLinecap="round"/>
                </svg>
                <input
                  type="text"
                  value={columnSearchQuery}
                  onChange={(e) => setColumnSearchQuery(e.target.value)}
                  placeholder="Find a column"
                  className="flex-1 outline-none text-xs text-[#333333] placeholder:text-[#333333] bg-transparent"
                />
              </div>
            </div>

            <div className="flex items-center justify-between mb-2">
              <div className="flex items-center gap-2">
                <Checkbox
                  checked={selectedColumns.length === searchableFields.length}
                  onChange={handleToggleAll}
                />
                <span className="text-sm font-medium text-[#333333]">All columns</span>
              </div>
              <span className="text-sm text-[#333333]">{selectedColumns.length} selected</span>
            </div>

            <div className="max-h-[250px] overflow-y-auto">
              {filteredColumns.map((field) => (
                <div key={field.fieldKey} className="flex items-center gap-3 py-1.5">
                  <Checkbox
                    checked={selectedColumns.includes(field.fieldKey)}
                    onChange={() => handleToggleColumn(field.fieldKey)}
                  />
                  <div className="flex items-center gap-2 min-w-0 flex-1">
                    {getFieldIcon(field.fieldKey)}
                    <span className="text-sm text-[#4F5051] truncate">{field.displayName}</span>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default SearchBoard;
